<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Geolocation</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	</head>
	<body>
		<script type="text/javascript">
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(
				function (pos) {
					var lati = pos.coords.latitude;
					var longi = pos.coords.longitude;

					var address = "http://geoapi.heartrails.com/api/json?method=searchByGeoLocation&x=" + longi + "&y=" + lati + "&jsonp=?"
					$.getJSON(address, function(json){
						$("#location").append(json.response.location[0].prefecture + json.response.location[0].city + json.response.location[0].town + "周辺"  );
					});

					var hotpepper = encodeURI("http://webservice.recruit.co.jp/hotpepper/gourmet/v1/?key=1f8a076c65aade23&lat=" + lati + "&lng=" + longi + "&range=1&is_open_time=now&ktai_coupon=0&format=jsonp&count=100&callback=?");

					$.getJSON(hotpepper, function(json){
						$.each(json.results.shop, function(i, shop){
							$("#result").append('<tr></tr>');
							$("#result tr:last").append('<td><img src="' + shop.photo.pc.s + '" alt="' + shop.name + '"></td>');
							$("#result tr:last").append('<td>' + shop.name + '</td>');
							$("#result tr:last").append('<td>' + shop.open + '</td>');
							$("#result tr:last").append('<td>' + shop.budget.average + '</td>');
							$("#result tr:last").append('<td>' + shop.budget_memo + '</td>');
							$("#result tr:last").append('<td><a href="' + shop.coupon_urls.sp + '" target="_blank">クーポン</a></td>');
						});
					});
				},
				function (pos) {
					var location = "<li>位置情報が取得できませんでした。</li>";
					document.getElementById("location").innerHTML = location;
				}
			);
		} else {
			window.alert("本ブラウザではGeolocationが使えません。");
		}
		</script>
		<ul id="location"></ul>
		<table id="result">
			<tr>
				<th></th><th>店名</th><th>営業時間</th><th>平均予算</th><th>料金備考</th><th>クーポンURL</th>
			</tr>
		</table>
	</body>
</html>