<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Geolocation</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="dns-prefetch" href="//fonts.googleapis.com" />
		<link rel="dns-prefetch" href="//code.jquery.com" />
		<link rel="stylesheet" href="./css/animate.css" />
		<link rel="stylesheet" href="style.css" />
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<style type="text/css">
			body {
				font-size: 18px;
			}
		</style>
	</head>
	<body>
		<script type="text/javascript">
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(
				function (pos) {
					var lati = pos.coords.latitude;
					var longi = pos.coords.longitude;

					var address = "http://geoapi.heartrails.com/api/json?method=searchByGeoLocation&x=" + longi + "&y=" + lati + "&jsonp=?"
					$.getJSON(address, function(json){
						$("#location").append("現在地：" + json.response.location[0].prefecture + json.response.location[0].city + json.response.location[0].town + "周辺"  );
					});

					var hotpepper = encodeURI("http://webservice.recruit.co.jp/hotpepper/gourmet/v1/?key=1f8a076c65aade23&lat=" + lati + "&lng=" + longi + "&range=1&ktai_coupon=0&format=jsonp&count=100&callback=?");

					$.getJSON(hotpepper, function(json){
						$.each(json.results.shop, function(i, shop){
							var span = '#span' + i;
							$("#result").append('<span id=' + span + ' ');
							$("#result").append('<tr></tr>');
							$("#result tr:last").append('<th rowspan="4" style="width:20%; vertical-align: middle; text-align: center;" border="1"><a href="' + shop.urls.pc + '"><img src="' + shop.photo.mobile.l + '" alt="' + shop.name + '" style="width:100%"></a></td>');
							$("#result tr:last").append('<th style="width:40%;">店名</th><th style="width:30%;">平均予算</th>');
							$("#result tr:last").append('<th rowspan="4" style="width:10%;" border="1"><a class="btn btn-default" href="' + shop.coupon_urls.sp + '" role="button">クーポン</a></td>');
							$("#result").append('<tr></tr>');
							$("#result tr:last").append('<td><a href="' + shop.urls.pc + '">' + shop.name + '</a></td>');
							$("#result tr:last").append('<td>' + shop.budget.average + '</td>');
							$("#result").append('<tr></tr>');
							$("#result tr:last").append('<th colspan="2">営業時間</th>');
							$("#result").append('<tr></tr>');
							$("#result tr:last").append('<td colspan="2">' + shop.open + '</td>');
							// $("#result tr:last").append('<td>' + shop.budget_memo + '</td>');
							if((i+1) % 2 == 1){
								$(span).addClass('fadeInLeftBig animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', $(this).removeClass());
							}else{
								$(span).addClass('fadeInRightBig animated').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', $(this).removeClass());
							}
						});
					});
				},
				function (pos) {
					var location = "<li>位置情報が取得できませんでした。</li>";
					document.getElementById("location").innerHTML = location;
				}
			);
		} else {
			window.alert("本ブラウザではGeolocationが使えません。");
		}
		</script>
		<ul id="location"></ul>
		<table id="result" class="table table-striped"></table>
	</body>
</html>